sequenceDiagram
    %% Diagram 2: Push Notification & Result Handling
    participant Backend as 서버 (RunPod Serverless)
    participant APNs as APNs
    participant PushHandler as PushNotificationsHandler
    participant ScanInteractor as ScanInteractor
    participant ScanWebRepo as ScanWebRepository (Client)
    participant DeepLink as DeepLinksHandler
    participant ContentView as ContentView
    participant ModelViewer as Model3DViewer

    Backend->>APNs: 처리 완료 푸시 전송
    APNs->>PushHandler: didReceive(notification)
    PushHandler->>ScanInteractor: handlePush(scanID)
    ScanInteractor->>ScanWebRepo: fetchScan(id)
    ScanWebRepo->>Backend: HTTP GET /fetchScan
    alt status=="finished"
        Backend-->>ScanWebRepo: DTO(usdzURL,…)
        ScanWebRepo->>Backend: downloadUSDZ(usdzURL)
        Backend-->>ScanWebRepo: USDZ 파일
        ScanWebRepo-->>ScanInteractor: USDZ data
        ScanInteractor->>DBRepo: Scan 객체 저장
        ScanInteractor->>DBRepo: uploadTask 상태 업데이트(.finished)
        PushHandler->>DeepLink: deepLink.showScan(scanID)
        DeepLink->>ContentView: 네비게이션 트리거
        ContentView->>ModelViewer: Model3DViewer 표시
    else
        Note over Backend: 아직 처리 중 또는 실패
    end